import{r as c,c as Q,o as j,V as P,W as g,X as s,a5 as u,f as l,a9 as W,U as S,Y as J,a0 as f,ae as X,af as Y,$ as x,a1 as k,k as Z,h as G,N as K,w as ee,Z as U,ac as te,ag as E,F as B,a2 as ae}from"./index-BKbFlLN1.js";import{Q as oe,a as A,P as le,b as ne,c as se,d as re,e as ue,_ as de,f as T}from"./QTable-C-ogjud7.js";import{a as C,Q as M,b as H,d as ie}from"./QLinearProgress-qCJtwm1t.js";import{g as $,s as h,b as L,Q as me}from"./product-storage-B3qwsH1N.js";import{q as O,Q as z,p as F}from"./QItem-DJSbFHKz.js";import"./QList-DnC_qoR9.js";const ve={class:"row q-col-gutter-md"},ce={class:"col-12 col-md-6"},pe={key:0},ge={class:"col-12 col-md-6"},fe={class:"col-12 col-md-6"},be={class:"col-12 col-md-6"},ye={class:"col-12 col-md-6"},we={class:"col-12 col-md-6"},Ve={class:"row justify-end q-gutter-sm"},_e={__name:"MovementForm",emits:["dataUpdated"],setup(r,{emit:b}){const p=b,m=c(null),i=c(),e=c({id:null,product:null,type:null,reason:null,amount:null,date:$(),responsible:"",dateRegistration:null}),v=c([]),y=c([]),w=["Compra","Devolução"],q=["Venda","Vencimento"],V=Q(()=>e.value.type==="Entrada"?w:e.value.type==="Saída"?q:[]),N=(t,o)=>{const a=t.toLowerCase();o(()=>{t===""?y.value=v.value:y.value=v.value.filter(D=>D.name.toLowerCase().includes(a))})},I=()=>{const t=localStorage.getItem("dataProducts");t&&(v.value=JSON.parse(t),y.value=v.value)},_=()=>{e.value={id:null,product:null,type:null,reason:null,amount:null,date:$(),responsible:"",dateRegistration:null},m.value&&m.value.focus()},R=t=>!(e.value.type==="Saída"&&e.value.product&&(i.value=e.value.product.amount||0,console.log("Quantidade do product:",i.value),t>i.value)),n=()=>{try{const t={id:Date.now(),productId:e.value.product.id,productCode:e.value.product.code,productName:e.value.product.name,type:e.value.type,reason:e.value.reason,amount:e.value.amount,date:e.value.date,responsible:e.value.responsible,dateRegistration:new Date().toISOString()},o=localStorage.getItem("dataMoviments");let a=[];o&&(a=JSON.parse(o)),a.push(t),localStorage.setItem("dataMoviments",JSON.stringify(a)),d(t),h("positive","Movimentação registrada com sucesso!"),p("dataUpdated"),_()}catch(t){console.error("Erro ao registrar movimentação:",t),h("negative","Erro ao registrar movimentação")}finally{le.hide()}},d=t=>{const o=[...v.value],a=o.findIndex(D=>D.id===t.productId);a!==-1&&(t.type==="Entrada"?o[a].amount+=t.amount:o[a].amount-=t.amount,localStorage.setItem("dataProducts",JSON.stringify(o)),v.value=o)};return j(()=>{I(),_()}),(t,o)=>(g(),P(H,{class:"q-pa-md no-box-shadow no-border-radius"},{default:s(()=>[o[7]||(o[7]=u("div",{class:"text-h5 q-mb-md"},"Cadastro de Movimentação de Estoque",-1)),l(oe,{onSubmit:W(n,["prevent"]),onReset:_,class:"q-gutter-md"},{default:s(()=>[u("div",ve,[u("div",ce,[l(C,{modelValue:e.value.product,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.product=a),options:y.value,label:"Selecione o Produto *","option-label":"name",filled:"","use-input":"","input-debounce":"300",onFilter:N,rules:[a=>!!a||"Produto é obrigatório"]},{"no-option":s(()=>[l(O,null,{default:s(()=>[l(z,null,{default:s(()=>o[6]||(o[6]=[x(" Nenhum product encontrado ")])),_:1})]),_:1})]),option:s(a=>[l(O,X(Y(a.itemProps)),{default:s(()=>[l(z,null,{default:s(()=>[l(F,null,{default:s(()=>[x(f(a.opt.name),1)]),_:2},1024),l(F,{caption:""},{default:s(()=>[x(" Código: "+f(a.opt.code)+" | Estoque atual: "+f(a.opt.amount),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),selected:s(()=>[e.value.product?(g(),S("div",pe,f(e.value.product.name)+" (Código: "+f(e.value.product.code)+") ",1)):J("",!0)]),_:1},8,["modelValue","options","rules"])]),u("div",ge,[l(C,{modelValue:e.value.type,"onUpdate:modelValue":o[1]||(o[1]=a=>e.value.type=a),options:["Entrada","Saída"],label:"Tipo de Movimentação *",filled:"",rules:[a=>!!a||"Tipo de movimentação é obrigatório"]},null,8,["modelValue","rules"])]),u("div",fe,[l(C,{modelValue:e.value.reason,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.reason=a),options:V.value,label:"Motivo da Movimentação *",filled:"",rules:[a=>!!a||"Motivo é obrigatório"]},null,8,["modelValue","options","rules"])]),u("div",be,[l(M,{modelValue:e.value.amount,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.amount=a),modelModifiers:{number:!0},type:"number",label:"Quantidade *",filled:"",rules:[a=>!!a||"Quantidade é obrigatória",a=>a>0||"A quantidade deve ser maior que zero",a=>R(a)||`Quantidade insuficiente em estoque. 
 Estoque atual:`+i.value]},null,8,["modelValue","rules"])]),u("div",ye,[l(M,{modelValue:e.value.responsible,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.responsible=a),label:"Responsável pela Movimentação *",filled:"",rules:[a=>!!a||"Responsável é obrigatório"],ref_key:"responsibleRef",ref:m},null,8,["modelValue","rules"])]),u("div",we,[l(M,{modelValue:e.value.date,"onUpdate:modelValue":o[5]||(o[5]=a=>e.value.date=a),type:"date",label:"Data da Movimentação *",filled:"",disable:"",rules:[a=>!!a||"Data é obrigatória"]},null,8,["modelValue","rules"])])]),l(A,{class:"q-my-md"}),u("div",Ve,[l(k,{label:"Limpar",type:"reset",color:"grey-7",flat:"",icon:"clear_all"}),l(k,{label:"Salvar",type:"submit",color:"primary",icon:"save"})])]),_:1})]),_:1}))}},Se=["top","middle","bottom"],xe=Z({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:r=>Se.includes(r)}},setup(r,{slots:b}){const p=Q(()=>r.align!==void 0?{verticalAlign:r.align}:null),m=Q(()=>{const i=r.outline===!0&&r.color||r.textColor;return`q-badge flex inline items-center no-wrap q-badge--${r.multiLine===!0?"multi":"single"}-line`+(r.outline===!0?" q-badge--outline":r.color!==void 0?` bg-${r.color}`:"")+(i!==void 0?` text-${i}`:"")+(r.floating===!0?" q-badge--floating":"")+(r.rounded===!0?" q-badge--rounded":"")+(r.transparent===!0?" q-badge--transparent":"")});return()=>G("div",{class:m.value,style:p.value,role:"status","aria-label":r.label},K(b.default,r.label!==void 0?[r.label]:[]))}}),Ce={class:"row justify-between items-center q-mb-md"},Pe={class:"row q-gutter-sm"},Qe={class:"full-width row flex-center text-accent q-gutter-sm"},qe={class:"row items-center justify-between full-width"},Me={__name:"MovementTable",setup(r){const b=c(!1),p=c(""),m=c("Todos"),i=c({sortBy:"dataRegistro",descending:!0,page:1,rowsPerPage:10}),e=c([]),v=[{name:"productId",label:"ID",field:"id",sortable:!0,align:"left"},{name:"productName",label:"Produto",field:"productName",sortable:!0,align:"left"},{name:"productCode",label:"Código",field:"productCode",sortable:!0,align:"left"},{name:"type",label:"Tipo",field:"type",sortable:!0,align:"center"},{name:"reason",label:"Motivo",field:"reason",sortable:!0,align:"left"},{name:"amount",label:"Quantidade",field:"amount",sortable:!0,align:"right"},{name:"date",label:"Data da Movimentação",field:"date",sortable:!0,align:"left"},{name:"responsible",label:"Responsável",field:"responsible",sortable:!0,align:"left"},{name:"dateRegistration",label:"Data de Registro",field:"dateRegistration",sortable:!0,align:"left"}],y=v.map(n=>({label:n.label,value:n.name})),w=c(["productName","productCode","type","reason","amount","date","responsible"]),q=Q(()=>v.filter(n=>w.value.includes(n.name))),V=Q(()=>{let n=e.value;return m.value!=="Todos"&&(n=n.filter(d=>d.type===m.value)),n}),N=n=>{if(!n)return"";try{return new Date(n).toLocaleString("pt-BR")}catch{return n}},I=n=>n==="Entrada"?"bg-green-1":"bg-red-1",_=()=>{b.value=!0;try{const n=localStorage.getItem("dataMoviments");n&&(e.value=JSON.parse(n))}catch(n){console.error("Erro ao carregar movimentações:",n)}finally{setTimeout(()=>{b.value=!1},200)}},R=()=>{window.addEventListener("storage",n=>{n.key==="movements"&&_()})};return j(()=>{_(),R()}),ee(m,()=>{i.value.page=1}),(n,d)=>(g(),S("div",null,[u("div",Ce,[l(M,{modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=t=>p.value=t),dense:"",placeholder:"Buscar...",class:"q-ml-md",style:{width:"200px"}},{append:s(()=>[l(U,{name:"search"})]),_:1},8,["modelValue"]),u("div",Pe,[l(C,{modelValue:m.value,"onUpdate:modelValue":d[1]||(d[1]=t=>m.value=t),options:["Todos","Entrada","Saída"],label:"Tipo",dense:"","options-dense":"",style:{width:"150px"}},null,8,["modelValue"]),l(C,{modelValue:w.value,"onUpdate:modelValue":d[2]||(d[2]=t=>w.value=t),multiple:"",options:te(y),label:"Colunas Visíveis",style:{"min-width":"200px"},dense:"","options-dense":"","emit-value":"","map-options":"","display-value":w.value.length?"Colunas selecionadas":""},null,8,["modelValue","options","display-value"])])]),l(ue,{rows:V.value,columns:q.value,"row-key":"id",filter:p.value,pagination:i.value,"onUpdate:pagination":d[5]||(d[5]=t=>i.value=t),loading:b.value,bordered:!0,dense:!0},{body:s(t=>[l(se,{props:t,class:E(I(t.row.type))},{default:s(()=>[(g(!0),S(B,null,ae(q.value,o=>(g(),P(re,{key:o.name,props:t},{default:s(()=>[o.name==="type"?(g(),P(xe,{key:0,color:t.row.type==="Entrada"?"positive":"negative"},{default:s(()=>[x(f(t.row.type),1)]),_:2},1032,["color"])):o.name==="date"||o.name==="dateRegistration"?(g(),S(B,{key:1},[x(f(N(t.row[o.field])),1)],64)):o.name==="amount"?(g(),S("span",{key:2,class:E(t.row.type==="Entrada"?"text-positive":"text-negative")},f(t.row.type==="Entrada"?"+":"-")+f(t.row[o.field]),3)):(g(),S(B,{key:3},[x(f(t.row[o.field]),1)],64))]),_:2},1032,["props"]))),128))]),_:2},1032,["props","class"])]),"no-data":s(({icon:t,filter:o})=>[u("div",Qe,[l(U,{size:"2em",name:"sentiment_dissatisfied"}),d[6]||(d[6]=u("span",null," Nenhuma movimentação encontrada ",-1)),l(U,{size:"2em",name:o?"filter_b_and_w":t},null,8,["name"])])]),bottom:s(()=>[u("div",qe,[u("div",null,"Total de movimentações: "+f(V.value.length),1),V.value.length>i.value.rowsPerPage?(g(),P(ne,{key:0,modelValue:i.value.page,"onUpdate:modelValue":d[3]||(d[3]=t=>i.value.page=t),max:Math.ceil(V.value.length/i.value.rowsPerPage),"direction-links":!0,"boundary-links":!0,color:"primary",size:"sm"},null,8,["modelValue","max"])):J("",!0),l(C,{modelValue:i.value.rowsPerPage,"onUpdate:modelValue":d[4]||(d[4]=t=>i.value.rowsPerPage=t),options:[5,10,20,50,100],label:"Por página",dense:"","options-dense":"","emit-value":"","map-options":"",style:{"min-width":"120px"}},null,8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination","loading"])]))}},ke={class:"row q-gutter-xl items-start justify-center"},Ne={style:{width:"300px"}},Ie={style:{flex:"1"}},$e={__name:"MovementPage",setup(r){const b=c(L("dataProducts")),p=c(!1),m=()=>{b.value=L("dataProducts")};return(i,e)=>(g(),P(me,{padding:"",class:"product-page"},{default:s(()=>[u("div",ke,[u("div",Ne,[e[3]||(e[3]=u("img",{alt:"DsBrito-logo",src:de,style:{width:"100%"}},null,-1)),e[4]||(e[4]=u("div",{class:"text-subtitle2 q-mb-sm"},"Verifique aqui o histórico de movimentações:",-1)),l(k,{label:"Registro de Movimentações",color:"primary",onClick:e[0]||(e[0]=v=>p.value=!0),class:"bg-secondary full-width"})]),u("div",Ie,[l(_e,{onDataUpdated:m})])]),l(ie,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=v=>p.value=v),"full-width":""},{default:s(()=>[l(H,{style:{"max-width":"900px",width:"100%"}},{default:s(()=>[l(T,{class:"row items-center justify-between"},{default:s(()=>[e[5]||(e[5]=u("div",{class:"text-h6"},"Histórico de Movimentações",-1)),l(k,{flat:"",icon:"close",round:"",dense:"",onClick:e[1]||(e[1]=v=>p.value=!1)})]),_:1}),l(A),l(T,null,{default:s(()=>[l(Me,{rows:b.value},null,8,["rows"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{$e as default};
