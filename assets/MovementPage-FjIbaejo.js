import{r as p,c as h,o as J,V as M,W as b,X as s,a6 as i,f as a,a9 as W,U as C,Y as A,a0 as y,af as X,ag as Z,$ as x,a1 as N,aa as E,k as G,h as K,N as ee,w as te,Z as U,ad as ae,ah as T,F as B,a2 as oe}from"./index-D_PcHH1C.js";import{Q as le,b as q,a as D,c as Y,d as H,P as ne,g as se,h as re,i as ue,j as ie,l as L,_ as de,m as me,n as O}from"./QTable-BG0KHW9q.js";import{Q as ve}from"./QPage-_phrVUoH.js";import{q as F,Q as z,p as j}from"./QItem-BOf3U6LN.js";const ce={class:"row q-col-gutter-md"},pe={class:"col-12 col-md-6"},ge={key:0},fe={class:"col-12 col-md-6"},be={class:"col-12 col-md-6"},ye={class:"col-12 col-md-6"},we={class:"col-12 col-md-6"},Ve={class:"col-12 col-md-6"},_e={class:"row justify-end q-gutter-sm"},Se={__name:"MovementForm",emits:["dataUpdated"],setup(u,{emit:w}){const g=w,v=p(null),m=p(),e=p({id:null,product:null,type:null,reason:null,amount:null,date:P(),responsible:"",dateRegistration:null}),c=p([]),V=p([]),_=["Compra","Devolução"],k=["Venda","Vencimento","Perda"],S=h(()=>e.value.type==="Entrada"?_:e.value.type==="Saída"?k:[]);function $(r,o){const t=r.toLowerCase();o(()=>{r===""?V.value=c.value:V.value=c.value.filter(Q=>Q.name.toLowerCase().includes(t))})}function I(){const r=localStorage.getItem("dataCompany");r&&(c.value=JSON.parse(r),V.value=c.value)}function P(){const r=new Date,o=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),Q=String(r.getDate()).padStart(2,"0");return`${o}-${t}-${Q}`}function R(){e.value.reason=null}function l(){e.value={id:null,product:null,type:null,reason:null,amount:null,date:P(),responsible:"",dateRegistration:null},v.value&&v.value.focus()}function d(r){return!(e.value.type==="Saída"&&e.value.product&&(m.value=e.value.product.amount||0,console.log("Quantidade do product:",m.value),r>m.value))}function n(){try{const r={id:Date.now(),productId:e.value.product.id,productCode:e.value.product.code,productName:e.value.product.name,type:e.value.type,reason:e.value.reason,amount:e.value.amount,date:e.value.date,responsible:e.value.responsible,dateRegistration:new Date().toISOString()},o=localStorage.getItem("movements");let t=[];o&&(t=JSON.parse(o)),t.push(r),localStorage.setItem("movements",JSON.stringify(t)),f(r),E.create({color:"positive",textColor:"white",icon:"check_circle",message:"Movimentação registrada com sucesso!",position:"top",timeout:2e3}),g("dataUpdated"),l()}catch(r){E.create({color:"negative",textColor:"white",icon:"error",message:`Erro ao registrar movimentação: ${r.message}`,position:"top"})}finally{ne.hide()}}function f(r){const o=[...c.value],t=o.findIndex(Q=>Q.id===r.productId);t!==-1&&(r.type==="Entrada"?o[t].amount+=r.amount:o[t].amount-=r.amount,localStorage.setItem("dataCompany",JSON.stringify(o)),c.value=o)}return J(()=>{I(),l()}),(r,o)=>(b(),M(H,{class:"q-pa-md no-box-shadow no-border-radius"},{default:s(()=>[o[7]||(o[7]=i("div",{class:"text-h5 q-mb-md"},"Cadastro de Movimentação de Estoque",-1)),a(le,{onSubmit:W(n,["prevent"]),onReset:l,class:"q-gutter-md"},{default:s(()=>[i("div",ce,[i("div",pe,[a(q,{modelValue:e.value.product,"onUpdate:modelValue":o[0]||(o[0]=t=>e.value.product=t),options:V.value,label:"Selecione o Produto *","option-label":"name",filled:"","use-input":"","input-debounce":"300",onFilter:$,rules:[t=>!!t||"Produto é obrigatório"]},{"no-option":s(()=>[a(F,null,{default:s(()=>[a(z,null,{default:s(()=>o[6]||(o[6]=[x(" Nenhum product encontrado ")])),_:1})]),_:1})]),option:s(t=>[a(F,X(Z(t.itemProps)),{default:s(()=>[a(z,null,{default:s(()=>[a(j,null,{default:s(()=>[x(y(t.opt.name),1)]),_:2},1024),a(j,{caption:""},{default:s(()=>[x(" Código: "+y(t.opt.code)+" | Estoque atual: "+y(t.opt.amount),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),selected:s(()=>[e.value.product?(b(),C("div",ge,y(e.value.product.name)+" (Código: "+y(e.value.product.code)+") ",1)):A("",!0)]),_:1},8,["modelValue","options","rules"])]),i("div",fe,[a(q,{modelValue:e.value.type,"onUpdate:modelValue":[o[1]||(o[1]=t=>e.value.type=t),R],options:["Entrada","Saída"],label:"Tipo de Movimentação *",filled:"",rules:[t=>!!t||"Tipo de movimentação é obrigatório"]},null,8,["modelValue","rules"])]),i("div",be,[a(q,{modelValue:e.value.reason,"onUpdate:modelValue":o[2]||(o[2]=t=>e.value.reason=t),options:S.value,label:"Motivo da Movimentação *",filled:"",rules:[t=>!!t||"Motivo é obrigatório"]},null,8,["modelValue","options","rules"])]),i("div",ye,[a(D,{modelValue:e.value.amount,"onUpdate:modelValue":o[3]||(o[3]=t=>e.value.amount=t),modelModifiers:{number:!0},type:"number",label:"Quantidade *",filled:"",rules:[t=>!!t||"Quantidade é obrigatória",t=>t>0||"A quantidade deve ser maior que zero",t=>d(t)||`Quantidade insuficiente em estoque. 
 Estoque atual:`+m.value]},null,8,["modelValue","rules"])]),i("div",we,[a(D,{modelValue:e.value.responsible,"onUpdate:modelValue":o[4]||(o[4]=t=>e.value.responsible=t),label:"Responsável pela Movimentação *",filled:"",rules:[t=>!!t||"Responsável é obrigatório"],ref_key:"responsibleRef",ref:v},null,8,["modelValue","rules"])]),i("div",Ve,[a(D,{modelValue:e.value.date,"onUpdate:modelValue":o[5]||(o[5]=t=>e.value.date=t),type:"date",label:"Data da Movimentação *",filled:"",disable:"",rules:[t=>!!t||"Data é obrigatória"]},null,8,["modelValue","rules"])])]),a(Y,{class:"q-my-md"}),i("div",_e,[a(N,{label:"Limpar",type:"reset",color:"grey-7",flat:"",icon:"clear_all"}),a(N,{label:"Salvar",type:"submit",color:"primary",icon:"save"})])]),_:1})]),_:1}))}},Ce=["top","middle","bottom"],xe=G({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:u=>Ce.includes(u)}},setup(u,{slots:w}){const g=h(()=>u.align!==void 0?{verticalAlign:u.align}:null),v=h(()=>{const m=u.outline===!0&&u.color||u.textColor;return`q-badge flex inline items-center no-wrap q-badge--${u.multiLine===!0?"multi":"single"}-line`+(u.outline===!0?" q-badge--outline":u.color!==void 0?` bg-${u.color}`:"")+(m!==void 0?` text-${m}`:"")+(u.floating===!0?" q-badge--floating":"")+(u.rounded===!0?" q-badge--rounded":"")+(u.transparent===!0?" q-badge--transparent":"")});return()=>K("div",{class:v.value,style:g.value,role:"status","aria-label":u.label},ee(w.default,u.label!==void 0?[u.label]:[]))}}),qe={class:"row justify-between items-center q-mb-md"},Pe={class:"row q-gutter-sm"},Qe={class:"full-width row flex-center text-accent q-gutter-sm"},Me={class:"row items-center justify-between full-width"},he={__name:"MovementTable",setup(u){const w=p(!1),g=p(""),v=p("Todos"),m=p({sortBy:"dataRegistro",descending:!0,page:1,rowsPerPage:10}),e=p([]),c=[{name:"productId",label:"ID",field:"id",sortable:!0,align:"left"},{name:"productName",label:"Produto",field:"productName",sortable:!0,align:"left"},{name:"productCode",label:"Código",field:"productCode",sortable:!0,align:"left"},{name:"type",label:"Tipo",field:"type",sortable:!0,align:"center"},{name:"reason",label:"Motivo",field:"reason",sortable:!0,align:"left"},{name:"amount",label:"Quantidade",field:"amount",sortable:!0,align:"right"},{name:"date",label:"Data da Movimentação",field:"date",sortable:!0,align:"left"},{name:"responsible",label:"Responsável",field:"responsible",sortable:!0,align:"left"},{name:"dateRegistration",label:"Data de Registro",field:"dateRegistration",sortable:!0,align:"left"}],V=c.map(l=>({label:l.label,value:l.name})),_=p(["productName","productCode","type","reason","amount","date","responsible"]),k=h(()=>c.filter(l=>_.value.includes(l.name))),S=h(()=>{let l=e.value;return v.value!=="Todos"&&(l=l.filter(d=>d.type===v.value)),l}),$=l=>{if(!l)return"";try{return new Date(l).toLocaleString("pt-BR")}catch{return l}},I=l=>l==="Entrada"?"bg-green-1":"bg-red-1",P=()=>{w.value=!0;try{const l=localStorage.getItem("movements");l&&(e.value=JSON.parse(l))}catch(l){console.error("Erro ao carregar movimentações:",l)}finally{setTimeout(()=>{w.value=!1},200)}},R=()=>{window.addEventListener("storage",l=>{l.key==="movements"&&P()})};return J(()=>{P(),R()}),te(v,()=>{m.value.page=1}),(l,d)=>(b(),C("div",null,[i("div",qe,[a(D,{modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=n=>g.value=n),dense:"",placeholder:"Buscar...",class:"q-ml-md",style:{width:"200px"}},{append:s(()=>[a(U,{name:"search"})]),_:1},8,["modelValue"]),i("div",Pe,[a(q,{modelValue:v.value,"onUpdate:modelValue":d[1]||(d[1]=n=>v.value=n),options:["Todos","Entrada","Saída"],label:"Tipo",dense:"","options-dense":"",style:{width:"150px"}},null,8,["modelValue"]),a(q,{modelValue:_.value,"onUpdate:modelValue":d[2]||(d[2]=n=>_.value=n),multiple:"",options:ae(V),label:"Colunas Visíveis",style:{"min-width":"200px"},dense:"","options-dense":"","emit-value":"","map-options":"","display-value":_.value.length?"Colunas selecionadas":""},null,8,["modelValue","options","display-value"])])]),a(ie,{rows:S.value,columns:k.value,"row-key":"id",filter:g.value,pagination:m.value,"onUpdate:pagination":d[5]||(d[5]=n=>m.value=n),loading:w.value,bordered:!0,dense:!0},{body:s(n=>[a(re,{props:n,class:T(I(n.row.type))},{default:s(()=>[(b(!0),C(B,null,oe(k.value,f=>(b(),M(ue,{key:f.name,props:n},{default:s(()=>[f.name==="type"?(b(),M(xe,{key:0,color:n.row.type==="Entrada"?"positive":"negative"},{default:s(()=>[x(y(n.row.type),1)]),_:2},1032,["color"])):f.name==="date"||f.name==="dateRegistration"?(b(),C(B,{key:1},[x(y($(n.row[f.field])),1)],64)):f.name==="amount"?(b(),C("span",{key:2,class:T(n.row.type==="Entrada"?"text-positive":"text-negative")},y(n.row.type==="Entrada"?"+":"-")+y(n.row[f.field]),3)):(b(),C(B,{key:3},[x(y(n.row[f.field]),1)],64))]),_:2},1032,["props"]))),128))]),_:2},1032,["props","class"])]),"no-data":s(({icon:n,filter:f})=>[i("div",Qe,[a(U,{size:"2em",name:"sentiment_dissatisfied"}),d[6]||(d[6]=i("span",null," Nenhuma movimentação encontrada ",-1)),a(U,{size:"2em",name:f?"filter_b_and_w":n},null,8,["name"])])]),bottom:s(()=>[i("div",Me,[i("div",null,"Total de movimentações: "+y(S.value.length),1),S.value.length>m.value.rowsPerPage?(b(),M(se,{key:0,modelValue:m.value.page,"onUpdate:modelValue":d[3]||(d[3]=n=>m.value.page=n),max:Math.ceil(S.value.length/m.value.rowsPerPage),"direction-links":!0,"boundary-links":!0,color:"primary",size:"sm"},null,8,["modelValue","max"])):A("",!0),a(q,{modelValue:m.value.rowsPerPage,"onUpdate:modelValue":d[4]||(d[4]=n=>m.value.rowsPerPage=n),options:[5,10,20,50,100],label:"Por página",dense:"","options-dense":"","emit-value":"","map-options":"",style:{"min-width":"120px"}},null,8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination","loading"])]))}},ke={class:"row q-gutter-xl items-start justify-center"},De={style:{width:"300px"}},Ne={style:{flex:"1"}},Be={__name:"MovementPage",setup(u){const w=p(L("dataCompany")),g=p(!1),v=()=>{w.value=L("dataCompany")};return(m,e)=>(b(),M(ve,{padding:"",class:"product-page"},{default:s(()=>[i("div",ke,[i("div",De,[e[3]||(e[3]=i("img",{alt:"DsBrito-logo",src:de,style:{width:"100%"}},null,-1)),e[4]||(e[4]=i("div",{class:"text-subtitle2 q-mb-sm"},"Verifique aqui o histórico de movimentações:",-1)),a(N,{label:"Registro de Movimentações",color:"primary",onClick:e[0]||(e[0]=c=>g.value=!0),class:"bg-secondary full-width"})]),i("div",Ne,[a(Se,{onDataUpdated:v})])]),a(me,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=c=>g.value=c),"full-width":""},{default:s(()=>[a(H,{style:{"max-width":"900px",width:"100%"}},{default:s(()=>[a(O,{class:"row items-center justify-between"},{default:s(()=>[e[5]||(e[5]=i("div",{class:"text-h6"},"Histórico de Movimentações",-1)),a(N,{flat:"",icon:"close",round:"",dense:"",onClick:e[1]||(e[1]=c=>g.value=!1)})]),_:1}),a(Y),a(O,null,{default:s(()=>[a(he,{rows:w.value},null,8,["rows"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Be as default};
